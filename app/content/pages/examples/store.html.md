---
title: 複雑なステート（ショップの例）
layout: article
order: 005
published: true
---

## Apple Storeの模写 --- complex-state

ここではApple Storeを模写しながら、Turbo, Stimulusのステートの使い方を考えてみます。Apple Storeの場合は以下のようになっています

* オプションを選択すると、それに応じてリアルタイムで表示価格が変更されます
    * 合計金額
    * 各オプションの隣に表示される合計価格 (例えば現在のモデルのRAMを1TBに変更した時に合計はいくらになるか)
* カラーオプションを選択すると、それに応じて画像が切り替わります
* 前のオプションを選択するまで、次のオプションは選択不可能状態です。オプションを選択すると、次のオプションは選択可能に切り替わります

また、オプション選択をしてもネットワーク通信は発生しません。価格更新を含めてすべてブラウザだけでやっています。何も考えないとコードがスパゲッティになりやすいぐらいの複雑さです。

## 複数の技術で実装して、比較する --- compare

比較的ステート管理が複雑な例ではないかと思いますので、これを使ってHotwireによるステート管理を議論したいと思います。以下の方法を検討します。

* **サーバでステート管理する場合:** オプションを選択するたびにサーバと通信を行い、レスポンスとして更新された画面を受け取ります。サーバ通信が発生するにも関わらず、Turboで良好なUI/UXを保つ方法を確認します
* **ブラウザでStimulusを使ってステート管理する場合:** 実際のApple Storeと同様にすべてブラウザで価格等の更新をします。複雑なステートをどのようにStimulusで管理し、画面の複数箇所を効率的に（コードをスパゲッティにせずに）更新するかを確認します
* **Reactを使ってステート管理する場合:** 実際のApple StoreはここだけがReactです（他は通常のMPA）。ブラウザだけでステートを管理し、ネットワーク通信せずに画面を更新するのはReactの得意分野です。Hotwireを使った方法と比較し、何が利点なのかを確認します
