---
title: モーダル
layout: article
order: 005
published: true
---

ウェブUIでよく見かけるモーダルですが、Hotwireで実装したというブログ記事はよく見かけます。そして多くの場合は「JavaScriptをほとんど使わないでできた！」っていうことを誇っています。

**しかしモーダルってそんな簡単なものでしょうか？私はそう思いません。** Hotwireを使えば、画面にモーダルを表示するのは簡単です。しかしUIは使ってこそ価値があります。細かい動作からアクセシビリティまでをJavaScriptなしで実装するのは無理です。

ここでは[モーダルUIの難しさ](https://zenn.dev/yend724/articles/20220511-pc51v32llyzu8kws)をしっかり見つめて、ちゃんとしたモーダルをHotwireで作る方法を考えたいと思います。また**Hotwireでできる最高のものを紹介したのちに、トーンダウンした簡単なものの作り方を紹介します**。

なお、**ここでお見せするものは、私が普段作成するモーダルよりも随分と柔軟性が高いものです**。通常はもっと簡単に実装します。いざとなったときでも対応できる**最終兵器**ぐらいに考えていただければと思います。

また多少脱線しますが、そもそもモーダルが本当に必要かどうかもこの機会に再考していただければと思います。これについては、個人的な意見ですが、[別途議論しました](/opinions/should_you_use_modals)。

## モーダルで考えるべきポイント --- modal-considerations

モーダルで実装する上で、以下のことを検討しておくべきかと思います。簡易的なモーダルの作り方だと、この一部は対応できますが、すべてには対応できません。

* モーダル表示のアニメーションは必要か否か:
  * モーダルの表示・非表示の際にアニメーションをつけることはよくあります。このためには、モーダルのHTMLを唐突に出現させたり消したりするだけでは不十分で、配慮をします
* サーバから非同期でデータ（HTML）を取得する必要があるか？: 
  * サーバ通信をすると、レスポンス遅延が発生します。レスポンスが得られる前に、ユーザに的確にフィードバックします（pending UI）
* モーダルの中でCRUDをするか？:
  * CRUDがあり、かつサーバサイドバリデーションのフィードバックをする場合は動作が複雑になります
  * サーババリデーションをフィードバックする際、成功失敗によって動作を変えます
     * 例えば成功した場合の動作として、自動的にモーダルを閉じて、背景画面も更新します
     * 一方で失敗した場合はモーダルを開いたままにし、エラーを表示します
  * 成功した時に自動的にモーダルを閉じる例を挙げましたが、一方で開いたままにするケースもあります
  * CreateやUpdateが成功したのちに、別のページにリダイレクトするかもしれしれません。あるいは背景のページを更新するだけかもしれません
* キーボードショートカットを含め、 [モーダルダイアログに期待されるアクセシビリティ](https://www.w3.org/WAI/ARIA/apg/patterns/dialog-modal/)がいくつかあります。モーダルを自作する場合はこれらをある程度用意する必要があります

## 今回の設計のポイント --- points-to-consider

モーダルは複数のアクションがあり、条件によって処理が分岐しますので、しっかり作ろうと思う場合は比較的複雑なUIになります。Hotwireを使えばコードの量は少なく済みますが、考えること自体を省略できるわけではありませんので、一つ一つ解説します。

モーダルダイアログでCRUDをする場合は、検討すべき項目が多いので、分割して紹介します。

1. [モーダルの表示・非表示](/examples/modal/modal-show-with-animation)
   1. モーダルのDOMをどこに配置するか
   2. モーダルをクリックするボタンとの距離の課題の解決
   3. 表示内容をサーバから取得するところ
   4. レスポンス遅延の対応
   5. モーダルをクローズする処理
2. [フォームを送信してモーダルを隠す](/examples/modal/modal-form-success-and-hide)
   1. フォームの送信
   2. 変更されたデータを使って背景にある画面を更新
   3. トーストの表示
   4. 成功した場合は自動的にモーダルを閉じる
   5. 失敗した場合はモーダルを表示したままにして、エラーを表示する

詳細はリンク先のページをご確認ください

## まとめ --- summary

モーダルダイアログは比較的簡単に作れてしまいますが、そのような簡易的なモーダルのUI/UXは十分とは言えません。「UI/UXにはこだわっていないので平気」とお考えかもしれませんが、こだわっていないのであれば、そもそもモーダルを使わない方が正しい選択の可能性が高いです。

とはいえ、このサイトではHotwireで優れたUI/UXが作成できることを紹介していますので、複数ページにわたって十分な機能を持ったモーダルの作り方を紹介しています。その場合は下図の下半分の<span class="text-blue-600">青色のTurboのところ</span>、および一番下の<span class="text-green-600">緑色のStimulusで補完するTurbo前後の２箇所</span>をすべて行う感じになります。

なお、[より単純化したケースの考え方については別途解説](/examples/modal/simpler-modals)します。実際には単純化したケースを採用することが多いです。

![interactive-flow-hotwire.webp](content_images/interactive-flow-hotwire.webp "max-w-[600px] mx-auto")


