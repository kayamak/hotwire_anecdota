---
title: Stimulus中のHTML生成を避ける理由
layout: article
order: 010
published: true
---

## HTML生成を避けるのは自主ルール

Stimulus Controllerの中でHTMLを生成することはできます。jQuery時代のように、JavaScriptコードで自在にHTMLは作れます。しかしそれを[HTML生成を自主的に避けるのがStimulusの流儀](https://stimulus.hotwired.dev/handbook/origin#the-three-core-concepts-in-stimulus)です。

その理由を私なりに紹介します。

## ERBとの重複を避ける

Railsの世界ではまずERBを使ってサーバサイドでHTMLをレンダリングするのが大原則となります。サーバでのERBレンダリングが**主**です。同じHTMLをStimulusでも生成してしまうと、HTMLを２箇所で記述することになってしまいます。これだと同じコードを複製することになり、メンテナンス上の問題になりやすいです。

Stimulus Controllerの中でHTMLレンダリングをなるべくしないのはこのためです。

## StimulusでHTMLレンダリングをすることもある

もちろんStimulusでHTMLをレンダリングしたり、直接DOMを記述することは可能です。jQueryではこれは一般的に行われていましたし、軽量のJavaScriptテンプレートライブラリも昔から存在する。やろうと思えば問題なくできます。

しかしHotwireのそもそもの存在意義はフロントエンドを簡単に書けるようすることです。簡単じゃなければ存在意義がありません。Viewのコードを書く箇所が重複して、メンテナンス負荷が大きくなったら本末転倒です。そのため、StimulusはCSSクラスの切り替えやHTML属性の変更、あるいはHTML内容のちょっとした書き換えに留めることを一般的には心がけます。

## Stimulusの中だけでHTMLレンダリングするなら問題ない

Hotwireで避けたいのはHTMLレンダリングのコードが重複してしまうことです。したがってサーバサイドでのレンダリングをやめて、クライアントサイドに完全に任せるなら問題ありません。実際、Stimulusの中でReact/JSXを書き、Stimulusのステートなどをpropsとして渡していくこともできます。

より一般的にはChart.jsなどを使って、StimulusでChart.js等にデータを渡すことは普通にやります。

## ブラウザとサーバで同じ言語を使えば良いのか？

「StimulusがHTMLレンダリングをしないのはコードの重複を避けるためだ」というのであれば、Next.jsのようにサーバとブラウザで同じJavaScriptを使い、双方で同じコードを実行すれば良いのではないかという意見もあります。

しかし実際にはセキュリティーに始まり、多くの問題があります。サーバコンポーネントやクライアントコンポーネントなど、聞いているだけで頭が痛くなります。

メリットはもちろんあると思いますが、どうも銀の弾ではなさそうです。
